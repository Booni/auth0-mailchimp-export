module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=n(14);e.exports=r.fromExpress(n(2))},function(e,t){e.exports=require("q")},function(e,t,n){function r(e,t){var n=e.webtaskContext,r=["AUTH0_DOMAIN","AUTH0_CLIENT_ID","AUTH0_CLIENT_SECRET","MAILCHIMP_API_KEY","MAILCHIMP_LIST_NAME","AUTH0_CONNECTION_NAME"],s=r.filter(function(e){return!n.data[e]});if(s.length)return t.status(400).send({message:"Missing settings: "+s.join(", ")});var i={TENANT_DOMAIN:e.webtaskContext.data.AUTH0_DOMAIN,USER_SEARCH_MGMT_TOKEN:e.access_token,MAILCHIMP_API_KEY:n.data.MAILCHIMP_API_KEY,MAILCHIMP_LIST_NAME:n.data.MAILCHIMP_LIST_NAME,AUTH0_CONNECTION_NAME:n.data.AUTH0_CONNECTION_NAME};o(i,function(e){return e?t.sendStatus(500).send("Error - please see logs for details"):t.status(200).send("All done!")})}function o(e,t){c(e).then(function(){return t()},function(e){return t(e)})}var s=n(8),i=s(),a=n(9),u=n(13),c=n(6),l=a({load:function(e,t,n,r,o){u.post(e).send({audience:t,grant_type:"client_credentials",client_id:n,client_secret:r}).type("application/json").end(function(e,t){e||!t.ok?o(null,e):o(t.body.access_token)})},hash:function(e){return e},max:100,maxAge:36e5});i.use(function(e,t,n){var r="https://"+e.webtaskContext.data.AUTH0_DOMAIN+"/oauth/token",o="https://"+e.webtaskContext.data.AUTH0_DOMAIN+"/api/v2/",s=e.webtaskContext.data.AUTH0_CLIENT_ID,i=e.webtaskContext.data.AUTH0_CLIENT_SECRET;l(r,o,s,i,function(t,r){return r?(console.error("Error getting access_token",r),n(r)):(e.access_token=t,void n())})}),i.get("/",r),i.post("/",r),e.exports=i},function(e,t,n){"use strict";var r=n(12),o=n(11),s=n(1),i=function(e,t,n,a){var u=e.TENANT_DOMAIN,c=e.USER_SEARCH_MGMT_TOKEN,l=e.AUTH0_CONNECTION_NAME,_=s.defer(),f={q:'identities.connection:"'+l+'"',search_engine:"v2",per_page:n,page:a,fields:"email",include_fields:"true"},p={method:"GET",url:"https://"+u+"/api/v2/users",qs:f,headers:{"cache-control":"no-cache",authorization:"Bearer "+c}};return r(p,function(r,s,u){if(r)return _.reject(new Error(r));var c=JSON.parse(u);return c.length>0?(t=o.concat(t,c),_.resolve(i(e,t,n,a+1))):_.resolve(t)}),_.promise},a=function(e){return function(t){i(e,[],20,0).then(function(e){var n=e.length;return console.log("Total number of Auth0 users: "+n),t(null,e)},function(e){console.error("ERROR: "+e),t(e)})}};e.exports=a},function(e,t){"use strict";var n=function(e,t){var n=e.MAILCHIMP_LIST_NAME;return function(e,r){t.lists_list({filters:{list_name:n}},function(t,n){if(t)return console.error(t),r(t);var o=n.data[0],s=o.id;console.log("MailChimp list id: "+s);var i=o.name;return console.log("MailChimp list name: "+i),r(null,{mailChimpList:o,auth0Users:e})})}};e.exports=n},function(e,t){"use strict";var n=function(e,t){return function(e,n){var r=e.mailChimpList.id,o=e.auth0Users;t.lists_batch_subscribe({id:r,batch:o.map(function(e){return{email:{email:e.email},email_type:"text",merge_vars:{FNAME:e.given_name||"",LNAME:e.family_name||""}}}),double_optin:!1,update_existing:!0,replace_interests:!0},function(t,r){return t?(console.error(t),n(t)):(console.log("Batch List update completed successfully"),n(null,e))})}};e.exports=n},function(e,t,n){"use strict";var r=n(10).MailChimpAPI,o=n(7),s=n(1),i=function(e){var t=e.MAILCHIMP_API_KEY;try{var i=new r(t,{version:"2.0"})}catch(e){return console.log(e.message)}var a=n(3)(e),u=n(4)(e,i),c=n(5)(e,i),l=s.defer();return o.waterfall([a,u,c],function(e){return e?(console.error(e),l.reject(new Error(e))):l.resolve()}),l.promise};e.exports=i},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("lru-memoizer")},function(e,t){e.exports=require("mailchimp")},function(e,t){e.exports=require("ramda")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("webtask-tools")}]);